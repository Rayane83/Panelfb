<%- include('base', { title: title, user: user, body: `
<div class="py-6">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- En-tête -->
        <div class="md:flex md:items-center md:justify-between">
            <div class="flex-1 min-w-0">
                <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate">
                    Gestion Staff
                </h2>
                <p class="mt-1 text-sm text-gray-500">
                    Gérez les employés, grades et permissions de vos entreprises
                </p>
            </div>
            <div class="mt-4 flex space-x-3 md:mt-0 md:ml-4">
                <button type="button" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <i data-lucide="user-plus" class="h-4 w-4 mr-2"></i>
                    Ajouter Employé
                </button>
                <button type="button" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <i data-lucide="plus" class="h-4 w-4 mr-2"></i>
                    Nouveau Grade
                </button>
            </div>
        </div>

        <!-- Statistiques -->
        <div class="mt-6">
            <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i data-lucide="users" class="h-6 w-6 text-gray-400"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">Total Employés</dt>
                                    <dd class="text-lg font-medium text-gray-900">
                                        <%= enterprises ? enterprises.reduce((total, ent) => total + (ent.employees ? ent.employees.length : 0), 0) : 0 %>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i data-lucide="building-2" class="h-6 w-6 text-gray-400"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">Entreprises</dt>
                                    <dd class="text-lg font-medium text-gray-900">
                                        <%= enterprises ? enterprises.length : 0 %>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i data-lucide="award" class="h-6 w-6 text-gray-400"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">Grades Actifs</dt>
                                    <dd class="text-lg font-medium text-gray-900">
                                        <%= enterprises ? enterprises.reduce((total, ent) => total + (ent.grades ? ent.grades.length : 0), 0) : 0 %>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i data-lucide="user-check" class="h-6 w-6 text-gray-400"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">Employés Actifs</dt>
                                    <dd class="text-lg font-medium text-gray-900">
                                        <%= enterprises ? enterprises.reduce((total, ent) => total + (ent.employees ? ent.employees.filter(emp => emp.status === 'Actif').length : 0), 0) : 0 %>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Onglets -->
        <div class="mt-6">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8">
                    <button class="tab-button border-indigo-500 text-indigo-600 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-tab="employees">
                        <i data-lucide="users" class="h-4 w-4 mr-2 inline"></i>
                        Employés
                    </button>
                    <button class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-tab="grades">
                        <i data-lucide="award" class="h-4 w-4 mr-2 inline"></i>
                        Grades
                    </button>
                    <button class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-tab="permissions">
                        <i data-lucide="shield" class="h-4 w-4 mr-2 inline"></i>
                        Permissions
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenu des onglets -->
        <div class="mt-6">
            <!-- Onglet Employés -->
            <div id="employees-tab" class="tab-content">
                <div class="bg-white shadow overflow-hidden sm:rounded-md">
                    <div class="px-4 py-5 sm:px-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">
                            Liste des Employés
                        </h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">
                            Tous les employés de vos entreprises
                        </p>
                    </div>
                    <ul class="divide-y divide-gray-200">
                        <% if (enterprises && enterprises.length > 0) { %>
                            <% enterprises.forEach(function(enterprise) { %>
                                <% if (enterprise.employees && enterprise.employees.length > 0) { %>
                                    <% enterprise.employees.forEach(function(employee) { %>
                                    <li>
                                        <div class="px-4 py-4 sm:px-6">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-10 w-10">
                                                        <img class="h-10 w-10 rounded-full" src="https://cdn.discordapp.com/avatars/<%= employee.discord_id %>/default.png" alt="<%= employee.username %>">
                                                    </div>
                                                    <div class="ml-4">
                                                        <div class="flex items-center">
                                                            <p class="text-sm font-medium text-indigo-600 truncate">
                                                                <%= employee.username %>
                                                            </p>
                                                            <p class="ml-2 text-sm text-gray-500">
                                                                - <%= enterprise.name %>
                                                            </p>
                                                        </div>
                                                        <div class="mt-1 flex items-center text-sm text-gray-500">
                                                            <p>
                                                                Grade: <%= employee.grade_id ? 'Assigné' : 'Non assigné' %>
                                                            </p>
                                                            <p class="ml-4">
                                                                Embauché le: <%= new Date(employee.hire_date).toLocaleDateString('fr-FR') %>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="flex items-center space-x-2">
                                                    <% 
                                                    let statusColor = employee.status === 'Actif' ? 'green' : 'red';
                                                    %>
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-<%= statusColor %>-100 text-<%= statusColor %>-800">
                                                        <%= employee.status || 'Actif' %>
                                                    </span>
                                                    <div class="flex items-center space-x-1">
                                                        <button class="text-indigo-600 hover:text-indigo-900 text-sm font-medium">
                                                            <i data-lucide="eye" class="h-4 w-4"></i>
                                                        </button>
                                                        <button class="text-gray-600 hover:text-gray-900 text-sm font-medium">
                                                            <i data-lucide="edit" class="h-4 w-4"></i>
                                                        </button>
                                                        <button class="text-red-600 hover:text-red-900 text-sm font-medium">
                                                            <i data-lucide="trash-2" class="h-4 w-4"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <% if (employee.qualifications && employee.qualifications.length > 0) { %>
                                            <div class="mt-4">
                                                <div class="text-sm text-gray-500 mb-2">Qualifications:</div>
                                                <div class="flex flex-wrap gap-2">
                                                    <% employee.qualifications.forEach(function(qualification) { %>
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                        <%= qualification %>
                                                    </span>
                                                    <% }); %>
                                                </div>
                                            </div>
                                            <% } %>
                                        </div>
                                    </li>
                                    <% }); %>
                                <% } %>
                            <% }); %>
                        <% } else { %>
                            <li>
                                <div class="px-4 py-8 text-center">
                                    <i data-lucide="users" class="mx-auto h-12 w-12 text-gray-400"></i>
                                    <h3 class="mt-2 text-sm font-medium text-gray-900">Aucun employé</h3>
                                    <p class="mt-1 text-sm text-gray-500">
                                        Commencez par ajouter des employés à vos entreprises.
                                    </p>
                                </div>
                            </li>
                        <% } %>
                    </ul>
                </div>
            </div>

            <!-- Onglet Grades -->
            <div id="grades-tab" class="tab-content hidden">
                <div class="bg-white shadow overflow-hidden sm:rounded-md">
                    <div class="px-4 py-5 sm:px-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">
                            Gestion des Grades
                        </h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">
                            Configurez les grades et leurs rémunérations
                        </p>
                    </div>
                    <ul class="divide-y divide-gray-200">
                        <% if (enterprises && enterprises.length > 0) { %>
                            <% enterprises.forEach(function(enterprise) { %>
                                <% if (enterprise.grades && enterprise.grades.length > 0) { %>
                                    <% enterprise.grades.forEach(function(grade) { %>
                                    <li>
                                        <div class="px-4 py-4 sm:px-6">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0">
                                                        <div class="h-10 w-10 rounded-full bg-yellow-100 flex items-center justify-center">
                                                            <i data-lucide="award" class="h-5 w-5 text-yellow-600"></i>
                                                        </div>
                                                    </div>
                                                    <div class="ml-4">
                                                        <div class="flex items-center">
                                                            <p class="text-sm font-medium text-indigo-600 truncate">
                                                                <%= grade.name %>
                                                            </p>
                                                            <p class="ml-2 text-sm text-gray-500">
                                                                - <%= enterprise.name %>
                                                            </p>
                                                        </div>
                                                        <div class="mt-1 flex items-center text-sm text-gray-500">
                                                            <p>
                                                                Hiérarchie: <%= grade.hierarchy || 1 %>
                                                            </p>
                                                            <p class="ml-4">
                                                                CA: <%= grade.ca_percentage || 0 %>%
                                                            </p>
                                                            <p class="ml-4">
                                                                Salaire: <%= new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(grade.base_salary || 0) %>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="flex items-center space-x-2">
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                        Actif
                                                    </span>
                                                    <div class="flex items-center space-x-1">
                                                        <button class="text-indigo-600 hover:text-indigo-900 text-sm font-medium">
                                                            <i data-lucide="eye" class="h-4 w-4"></i>
                                                        </button>
                                                        <button class="text-gray-600 hover:text-gray-900 text-sm font-medium">
                                                            <i data-lucide="edit" class="h-4 w-4"></i>
                                                        </button>
                                                        <button class="text-red-600 hover:text-red-900 text-sm font-medium">
                                                            <i data-lucide="trash-2" class="h-4 w-4"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm">
                                                <div>
                                                    <span class="font-medium text-gray-700">Taux horaire:</span>
                                                    <%= new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(grade.hourly_rate || 0) %>
                                                </div>
                                                <div>
                                                    <span class="font-medium text-gray-700">Pourcentage CA:</span>
                                                    <%= grade.ca_percentage || 0 %>%
                                                </div>
                                                <div>
                                                    <span class="font-medium text-gray-700">Salaire de base:</span>
                                                    <%= new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(grade.base_salary || 0) %>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <% }); %>
                                <% } %>
                            <% }); %>
                        <% } else { %>
                            <li>
                                <div class="px-4 py-8 text-center">
                                    <i data-lucide="award" class="mx-auto h-12 w-12 text-gray-400"></i>
                                    <h3 class="mt-2 text-sm font-medium text-gray-900">Aucun grade</h3>
                                    <p class="mt-1 text-sm text-gray-500">
                                        Commencez par créer des grades pour vos entreprises.
                                    </p>
                                </div>
                            </li>
                        <% } %>
                    </ul>
                </div>
            </div>

            <!-- Onglet Permissions -->
            <div id="permissions-tab" class="tab-content hidden">
                <div class="bg-white shadow sm:rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">
                            Gestion des Permissions
                        </h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">
                            Configurez les permissions par rôle Discord
                        </p>
                        
                        <div class="mt-6">
                            <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg">
                                <table class="min-w-full divide-y divide-gray-300">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">Rôle</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">Dashboard</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">Dotations</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">Impôts</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">Staff</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">Admin</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Superadmin</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Superviseur</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">DOT</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Patron</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Co-Patron</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Employé</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="check" class="h-4 w-4 text-green-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <i data-lucide="x" class="h-4 w-4 text-red-500"></i>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Gestion des onglets
document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', function() {
        const tabName = this.getAttribute('data-tab');
        
        // Masquer tous les contenus d'onglets
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden');
        });
        
        // Réinitialiser tous les boutons d'onglets
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('border-indigo-500', 'text-indigo-600');
            btn.classList.add('border-transparent', 'text-gray-500');
        });
        
        // Activer l'onglet sélectionné
        this.classList.remove('border-transparent', 'text-gray-500');
        this.classList.add('border-indigo-500', 'text-indigo-600');
        
        // Afficher le contenu de l'onglet
        document.getElementById(tabName + '-tab').classList.remove('hidden');
    });
});
</script>
` }) %>